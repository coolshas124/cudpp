<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>CUDPP: Overview of CUDPP hash tables</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CUDPP&#160;<span id="projectnumber">2.0</span></div>
   <div id="projectbrief">CUDA Data-Parallel Primitives Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Overview of CUDPP hash tables </div>  </div>
</div>
<div class="contents">
<div class="textblock"><p>Hash tables are useful for efficiently storing and retrieving sparse data sets. Unlike dense representations, the size of a hash table is generally proportional to the number of elements stored in it rather than the size of the space of possible elements. Hash tables should also have a small cost to insert items and a small cost to retrieve items. CUDPP hash tables have these properties.</p>
<p>CUDPP includes three different hash table types: </p>
<table  style="width:90%; margin: auto; border: 1px solid #dddddd;">
<tr>
<th class="classes" style="padding-right: 1em;"><a class="el" href="cudpp__hash_8h.html#aafb866af39fe4f36e06273bd472fc3eca56e0807d5df3252f3cff24ca07b31b53">CUDPP_BASIC_HASH_TABLE</a>  </th><td>Stores a single value per key. The input is expected to be a set of key-value pairs, where the keys are all unique.   </td></tr>
<tr>
<th class="classes" style="padding-right: 1em;"><a class="el" href="cudpp__hash_8h.html#aafb866af39fe4f36e06273bd472fc3eca77bbd2a8ecced87214792e6aed5b5e70">CUDPP_COMPACTING_HASH_TABLE</a>  </th><td>Assigns each key a unique identifier and allows O(1) translation between the key and the unique IDs. Input is a set of keys that may, or may not, be repeated.   </td></tr>
<tr>
<th class="classes" style="padding-right: 1em;"><a class="el" href="cudpp__hash_8h.html#aafb866af39fe4f36e06273bd472fc3ecad7c0a538eb0d8ca71b05e2c5e6a68282">CUDPP_MULTIVALUE_HASH_TABLE</a>  </th><td>Allows you to store multiple values for each key. Multiple values for the same key are represented by different key-value pairs in the input.   </td></tr>
</table>
<h2><a class="anchor" id="hash_using"></a>
Using CUDPP hash tables</h2>
<p>CUDPP supports four major routines for hash tables: creating a hash table (<a class="el" href="group__public_interface.html#ga0cd993f24223a9e5b59fc84bff5be22b">cudppHashTable</a>), inserting items (typically key/value pairs) into a hash table (<a class="el" href="group__public_interface.html#gaa93793870394fdb90859d6f1e0ff662b">cudppHashInsert</a>), retrieving values from a hash table given their keys (<a class="el" href="group__public_interface.html#ga8a351e4f3c9d69e3111c3463784e7ebe">cudppHashRetrieve</a>), and destroying the hash table (<a class="el" href="group__public_interface.html#gac78326e26664036e8526de8f7a662c0f">cudppDestroyHashTable</a>). Each of these routines works with each of the 3 types of hash tables above.</p>
<p>A typical use of a hash table might look like this (see the sample application cudpp_hash_testrig for a complete example):</p>
<ul>
<li>Create and populate two arrays in GPU device memory, one of keys, one of values.</li>
<li>Configure a <a class="el" href="struct_c_u_d_p_p_hash_table_config.html" title="Configuration struct for creating a hash table (CUDPPHashTable())">CUDPPHashTableConfig</a> data structure with:<ul>
<li>the type of hash table (<a class="el" href="cudpp__hash_8h.html#aafb866af39fe4f36e06273bd472fc3ec">CUDPPHashTableType</a>);</li>
<li><em>kInputSize</em>, the number of items to be inserted into the hash table; and</li>
<li>the space usage multiplier <em>space_usage</em>; the hash table will store kInputSize elements but require kInputSize * space_usage elements of storage. Smaller space_usage factors use less space overall but take longer to build. The cudpp_hash_testrig example tests with five <em>space_usage</em> factors from 1.05 to 2.0.</li>
</ul>
</li>
<li>Initialize the table using <a class="el" href="group__public_interface.html#ga0cd993f24223a9e5b59fc84bff5be22b">cudppHashTable</a>.</li>
<li>Insert the keys and arrays into the hash table using <a class="el" href="group__public_interface.html#gaa93793870394fdb90859d6f1e0ff662b">cudppHashInsert</a>.</li>
<li>Create two arrays in GPU device memory, one populated with a list of retrieval keys, and one empty to retrieve the value associated with those keys.</li>
<li>Retrieve those values with <a class="el" href="group__public_interface.html#ga8a351e4f3c9d69e3111c3463784e7ebe">cudppHashRetrieve</a>.</li>
<li>When you're done, destroy the hash table with <a class="el" href="group__public_interface.html#gac78326e26664036e8526de8f7a662c0f">cudppDestroyHashTable</a>.</li>
</ul>
<h2><a class="anchor" id="hash_other_software"></a>
Other software used in CUDPP's hash tables</h2>
<p>CUDPP's hash table library relies on a good random number generator to ensure good hash function generation. CUDPP uses the Mersenne Twister implementation provided by Makoto Matsumoto, <a href="http://www.math.sci.hiroshima-u.ac.jp/~m-mat/MT/MT2002/emt19937ar.html">available here</a> (and included in the CUDPP distribution). You may try using your system's rand() function and srand() functions, but keep in mind that Windows' generator produces numbers in a very small range.</p>
<p>The compacting hash table and multivalue hash table implementation use CUDPP's scan and sort functionality.</p>
<h2><a class="anchor" id="hash_space_limitations"></a>
Hash table space limitations</h2>
<p>The maximum size of the hash table implementations are primarily limited by the size of available memory. The figures below indicate the size of the hash table as a function of:</p>
<ul>
<li>N, the number of elements in the hash table;</li>
<li>K, the number of unique keys in the input (for the multivalue and compacting hash table); and</li>
<li>M, the space multiplier for the hash table (for every 1 element to be stored in the hash table, we allocate space for M elements). M defaults to 1.25.</li>
</ul>
<h3><a class="anchor" id="basic_hash_space_limitations"></a>
Basic hash table:</h3>
<p>Other than some 32-bit values (like an error flag and the number of items in the stash), the only memory allocation is for the actual hash table itself:</p>
<ul>
<li>Hash table: 2 * (M * N + 101) uint32s</li>
</ul>
<p>101 is the size of the stash (in uint32s). We multiply by 2 because we store both keys and values.</p>
<h3><a class="anchor" id="multivalue_hash_space_limitations"></a>
Multi-value hash table:</h3>
<p>In the multivalue hash table, memory is held until the hash table is deleted; it was set up this way to prevent mucking up the timings with memory management.</p>
<ul>
<li>Hash table: 2 * (M * K + 101) uint32s</li>
<li>Values of all of the keys: N uint32s</li>
<li>Information about each key's values: 2 * K uint32s</li>
<li>Compacted list of the keys: K uint32s</li>
<li>Scratch memory, CUDPP scan: Enough to scan N items. Note that scan has its own limitation on size (~67M elements).</li>
<li>Scratch memory, radix sort: 2N uint32s. Note that sort has its own limitation on size (~2B elements).</li>
<li>Scratch memory, additional: N uint32s</li>
</ul>
<p>Each key is capped at UINT_MAX values. Although the code doesn't do it, you could in theory creatively re-use some of the memory or move allocations around to avoid having to hold onto more scratch space than you really need. The CUDPP scan memory, for example, is allocated when the hash table is initialized but only used when it's being built.</p>
<h3><a class="anchor" id="compacting_hash_space_limitations"></a>
Compacting hash table:</h3>
<ul>
<li>Hash table: 2 * (M * N + 101) uint32s</li>
<li>Compacted unique keys: K uint32s</li>
<li>Scratch memory: 3 * (M * N + 101) uint32s</li>
<li>Scratch memory, CUDPP scan: Enough to scan N + 101 uint32s. Note that scan has its own limitation on size (~67M elements). </li>
</ul>
</div></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<hr class="footer"/><address class="footer"><small>Generated on Tue Aug 9 2011 11:59:20 for CUDPP by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </small></address>
</body>
</html>
